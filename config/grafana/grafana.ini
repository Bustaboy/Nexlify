# config/grafana/grafana.ini
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# NEXLIFY GRAFANA 12.0 CONFIGURATION - CYBERPUNK EDITION
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#
# Custom configuration for the ultimate trading visualization matrix
# Optimized for performance, secured for production, styled for Night City
# 
# "Style and substance - in the matrix, you need both." - Alt Cunningham
#
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

##################### Grafana Configuration #####################
#
# Everything has defaults so you only need to uncomment things you want to
# change. Restart Grafana after modifications.

#################################### Paths ####################################
[paths]
# Path to where grafana stores temp files, sessions, and the sqlite3 db (if used)
data = ${GRAFANA_DATA_PATH:-/var/lib/grafana}

# Temporary files in `data` directory older than given duration will be removed
temp_data_lifetime = ${GRAFANA_TEMP_DATA_LIFETIME:-24h}

# Directory where grafana stores logs
logs = ${GRAFANA_LOGS_PATH:-/var/log/grafana}

# Directory where grafana will automatically scan and look for plugins
plugins = ${GRAFANA_PLUGINS_PATH:-/var/lib/grafana/plugins}

# Folder that contains provisioning config files that grafana will apply on startup
provisioning = ${GRAFANA_PROVISIONING_PATH:-/etc/grafana/provisioning}

#################################### Server ####################################
[server]
# Protocol (http, https, h2, socket)
protocol = ${GRAFANA_PROTOCOL:-http}

# The http port to use
http_port = ${GRAFANA_PORT:-3000}

# The public facing domain name used to access grafana
domain = ${GRAFANA_DOMAIN:-localhost}

# Redirect to correct domain if host header does not match domain
enforce_domain = ${GRAFANA_ENFORCE_DOMAIN:-false}

# The full public facing url
root_url = ${GRAFANA_ROOT_URL:-%(protocol)s://%(domain)s:%(http_port)s/}

# Serve Grafana from subpath specified in `root_url` setting
serve_from_sub_path = ${GRAFANA_SERVE_FROM_SUB_PATH:-false}

# Log web requests
router_logging = ${GRAFANA_ROUTER_LOGGING:-false}

# Enable gzip
enable_gzip = ${GRAFANA_ENABLE_GZIP:-true}

# https certs & key file (if protocol is https)
cert_file = ${GRAFANA_CERT_FILE:-}
cert_key = ${GRAFANA_CERT_KEY:-}

# Unix socket path (if protocol is socket)
socket = ${GRAFANA_SOCKET:-}

# CDN URL - use for loading assets from CDN
cdn_url = ${GRAFANA_CDN_URL:-}

# Enable alpha (experimental) features
enable_alpha = ${GRAFANA_ENABLE_ALPHA:-true}

#################################### Database ####################################
[database]
# Use either URL or individual params
url = ${DATABASE_URL:-}

# Or specify individually
type = ${DATABASE_TYPE:-sqlite3}
host = ${DATABASE_HOST:-}
name = ${DATABASE_NAME:-grafana}
user = ${DATABASE_USER:-}
password = ${DATABASE_PASSWORD:-}

# Only applicable for sqlite3 database
path = ${DATABASE_PATH:-grafana.db}

# Max idle conn setting default is 2
max_idle_conn = ${DATABASE_MAX_IDLE_CONN:-2}

# Max conn setting default is 0 (mean not set)
max_open_conn = ${DATABASE_MAX_OPEN_CONN:-}

# Connection Max Lifetime default is 14400 (4 hours)
conn_max_lifetime = ${DATABASE_CONN_MAX_LIFETIME:-14400}

# Set to true to log the sql calls and execution times
log_queries = ${DATABASE_LOG_QUERIES:-false}

# For sqlite3 only. Shared cache setting
cache_mode = ${DATABASE_CACHE_MODE:-shared}

# For mysql only. Connection pool size
connection_pool_size = ${DATABASE_CONNECTION_POOL_SIZE:-100}

#################################### Cache server #############################
[remote_cache]
# Either "redis", "memcached", "database" default is "database"
type = ${CACHE_TYPE:-redis}

# Cache connection string
connstr = ${CACHE_CONNSTR:-addr=nexlify-cache:6379,pool_size=100,db=0,ssl=false}

# Prefix for keys
prefix = ${CACHE_PREFIX:-grafana}

#################################### Security ####################################
[security]
# Disable creation of admin user on first start of grafana
disable_initial_admin_creation = ${SECURITY_DISABLE_INITIAL_ADMIN:-false}

# Default admin user
admin_user = ${SECURITY_ADMIN_USER:-admin}

# Default admin password
admin_password = ${SECURITY_ADMIN_PASSWORD:-nexlify2025}

# Default admin email
admin_email = ${SECURITY_ADMIN_EMAIL:-admin@nexlify.io}

# Used for signing
secret_key = ${SECURITY_SECRET_KEY:-SW2YcwTIb9zpOOhoPsMm}

# Disable gravatar profile images
disable_gravatar = ${SECURITY_DISABLE_GRAVATAR:-false}

# Data source proxy whitelist
data_source_proxy_whitelist = ${SECURITY_DATA_SOURCE_PROXY_WHITELIST:-}

# Disable brute force login protection
disable_brute_force_login_protection = ${SECURITY_DISABLE_BRUTE_FORCE:-false}

# Set to true if behind HTTPS
cookie_secure = ${SECURITY_COOKIE_SECURE:-false}

# Set cookie SameSite attribute
cookie_samesite = ${SECURITY_COOKIE_SAMESITE:-lax}

# Set to true if you want to allow browsers to render Grafana in an iframe
allow_embedding = ${SECURITY_ALLOW_EMBEDDING:-false}

# Set to true if you want to enable http strict transport security (HSTS)
strict_transport_security = ${SECURITY_STRICT_TRANSPORT:-false}

# Sets how long a browser should cache HSTS
strict_transport_security_max_age_seconds = ${SECURITY_HSTS_MAX_AGE:-86400}

# Set to true if to enable HSTS preloading option
strict_transport_security_preload = ${SECURITY_HSTS_PRELOAD:-false}

# Set to true if to enable the HSTS includeSubDomains option
strict_transport_security_subdomains = ${SECURITY_HSTS_SUBDOMAINS:-false}

# Set to true to enable the X-Content-Type-Options response header
x_content_type_options = ${SECURITY_X_CONTENT_TYPE_OPTIONS:-true}

# Set to true to enable the X-XSS-Protection header
x_xss_protection = ${SECURITY_X_XSS_PROTECTION:-true}

# Enable adding the Content-Security-Policy header
content_security_policy = ${SECURITY_CSP_ENABLED:-false}

# CSP template
content_security_policy_template = ${SECURITY_CSP_TEMPLATE:-"script-src 'self' 'unsafe-eval' 'unsafe-inline' 'strict-dynamic' $NONCE;object-src 'none';font-src 'self';style-src 'self' 'unsafe-inline' blob:;img-src * data:;base-uri 'self';connect-src 'self' grafana.com ws://$ROOT_PATH wss://$ROOT_PATH;manifest-src 'self';media-src 'none';form-action 'self';"}

# Enable adding the Content-Security-Policy-Report-Only header
content_security_policy_report_only = ${SECURITY_CSP_REPORT_ONLY:-false}

#################################### Users ####################################
[users]
# Disable user signup / registration
allow_sign_up = ${USERS_ALLOW_SIGN_UP:-false}

# Allow non admin users to create organizations
allow_org_create = ${USERS_ALLOW_ORG_CREATE:-false}

# Set to true to automatically assign new users to the default organization
auto_assign_org = ${USERS_AUTO_ASSIGN_ORG:-true}

# Default organization id
auto_assign_org_id = ${USERS_AUTO_ASSIGN_ORG_ID:-1}

# Default role new users will be assigned
auto_assign_org_role = ${USERS_AUTO_ASSIGN_ORG_ROLE:-Viewer}

# Require email validation
verify_email_enabled = ${USERS_VERIFY_EMAIL_ENABLED:-false}

# Login hint
login_hint = ${USERS_LOGIN_HINT:-Welcome to the Nexlify Trading Matrix}

# Default UI theme ("dark" or "light" or "system")
default_theme = ${USERS_DEFAULT_THEME:-dark}

# Default UI color theme
default_color_theme = ${USERS_DEFAULT_COLOR_THEME:-sapphire-dusk}

# External user management
external_manage_link_url = ${USERS_EXTERNAL_MANAGE_LINK_URL:-}
external_manage_link_name = ${USERS_EXTERNAL_MANAGE_LINK_NAME:-}
external_manage_info = ${USERS_EXTERNAL_MANAGE_INFO:-}

# Viewers can edit/inspect dashboard settings in the browser
viewers_can_edit = ${USERS_VIEWERS_CAN_EDIT:-false}

# Editors can admin organizations (Removed in v12.0)
# editors_can_admin = false

# Login cookie name
login_cookie_name = ${USERS_LOGIN_COOKIE_NAME:-grafana_session}

# Disable login form
disable_login_form = ${USERS_DISABLE_LOGIN_FORM:-false}

# Disable signout
disable_signout_menu = ${USERS_DISABLE_SIGNOUT_MENU:-false}

# URL to redirect after sign out
signout_redirect_url = ${USERS_SIGNOUT_REDIRECT_URL:-}

# Set to true to attempt login with OAuth
oauth_auto_login = ${USERS_OAUTH_AUTO_LOGIN:-false}

# OAuth state max age
oauth_state_cookie_max_age = ${USERS_OAUTH_STATE_COOKIE_MAX_AGE:-600}

# Limit the api_key until using it
api_key_max_seconds_to_live = ${USERS_API_KEY_MAX_SECONDS:--1}

# Viewers can save views for dashboards
viewers_can_save_views = ${USERS_VIEWERS_CAN_SAVE_VIEWS:-false}

#################################### Anonymous Auth ############################
[auth.anonymous]
# Enable Anonymous access
enabled = ${AUTH_ANONYMOUS_ENABLED:-false}

# Organization name that should be used for unauthenticated users
org_name = ${AUTH_ANONYMOUS_ORG_NAME:-Main Org.}

# Role for unauthenticated users
org_role = ${AUTH_ANONYMOUS_ORG_ROLE:-Viewer}

# Hide login link
hide_version = ${AUTH_ANONYMOUS_HIDE_VERSION:-false}

#################################### Basic Auth ##################################
[auth.basic]
# Enable basic authentication
enabled = ${AUTH_BASIC_ENABLED:-true}

#################################### SAML Auth ###################################
[auth.saml]
# Enable SAML authentication
enabled = ${AUTH_SAML_ENABLED:-false}

# Enable SAML single logout
single_logout = ${AUTH_SAML_SINGLE_LOGOUT:-false}

# Allow SAML sign up
allow_sign_up = ${AUTH_SAML_ALLOW_SIGN_UP:-true}

# Auto login (bypasses the login screen)
auto_login = ${AUTH_SAML_AUTO_LOGIN:-false}

#################################### Logging ##################################
[log]
# Either "console", "file", "syslog"
mode = ${LOG_MODE:-console file}

# Either "debug", "info", "warn", "error", "critical"
level = ${LOG_LEVEL:-info}

# Optional settings to set different levels for specific loggers
filters = ${LOG_FILTERS:-}

# For "console" mode only
[log.console]
level = ${LOG_CONSOLE_LEVEL:-}
format = ${LOG_CONSOLE_FORMAT:-console}

# For "file" mode only
[log.file]
level = ${LOG_FILE_LEVEL:-}
format = ${LOG_FILE_FORMAT:-text}
log_rotate = ${LOG_FILE_ROTATE:-true}
max_lines = ${LOG_FILE_MAX_LINES:-1000000}
max_size_shift = ${LOG_FILE_MAX_SIZE_SHIFT:-28}
daily_rotate = ${LOG_FILE_DAILY_ROTATE:-true}
max_days = ${LOG_FILE_MAX_DAYS:-7}

#################################### Alerting ####################################
[alerting]
# Enable the legacy alerting engine & UI
enabled = ${ALERTING_ENABLED:-false}

# Makes it possible to turn off alert execution
execute_alerts = ${ALERTING_EXECUTE_ALERTS:-true}

# Default setting for alert calculation timeout
evaluation_timeout = ${ALERTING_EVALUATION_TIMEOUT:-30s}

# Default setting for alert notification timeout
notification_timeout = ${ALERTING_NOTIFICATION_TIMEOUT:-30s}

# Default setting for max attempts to sending alert notifications
max_attempts = ${ALERTING_MAX_ATTEMPTS:-3}

# Makes it possible to turn off alert execution but still see alerts
min_interval_seconds = ${ALERTING_MIN_INTERVAL_SECONDS:-1}

# Max number of alert annotations returned in an alert query result
max_annotation_age = ${ALERTING_MAX_ANNOTATION_AGE:-}

# Max number of alert annotations returned in an alert query result
max_annotations_to_keep = ${ALERTING_MAX_ANNOTATIONS_TO_KEEP:-}

#################################### Unified Alerting ##########################
[unified_alerting]
# Enable the Unified Alerting engine
enabled = ${UNIFIED_ALERTING_ENABLED:-true}

# Base interval for executing alerting rules
min_interval = ${UNIFIED_ALERTING_MIN_INTERVAL:-10s}

# Disables the creation of a default Alertmanager instance
disable_alertmanager = ${UNIFIED_ALERTING_DISABLE_ALERTMANAGER:-false}

# URL of the Alertmanager to use
alertmanager_config_api_url = ${UNIFIED_ALERTING_ALERTMANAGER_URL:-}

# Comma-separated list of organization IDs to migrate from legacy alerting
execute_alerts_migration = ${UNIFIED_ALERTING_EXECUTE_MIGRATION:-}

#################################### Explore #####################################
[explore]
# Enable the Explore section
enabled = ${EXPLORE_ENABLED:-true}

#################################### Feature Management #############################
[feature_management]
# Set to true to enable feature management
enable = ${FEATURE_MANAGEMENT_ENABLE:-true}

[feature_toggles]
# Enable features, separated by spaces
enable = ${FEATURE_TOGGLES_ENABLE:-scenes dashboardsFromStorage tableNextGen dynamicDashboards newDashboardSchemaMigration transformationsVariableSupport mlExpressions prometheusResourceBrowserCache sqlExpressions gitSync scim}

# Disable features, separated by spaces
disable = ${FEATURE_TOGGLES_DISABLE:-}

#################################### Grafana Image Renderer Plugin ##############
[plugin.grafana-image-renderer]
# Instruct headless browser instance to run in 'remote' mode
rendering_mode = ${RENDERER_MODE:-clustered}

# How many browser instances to run in parallel
concurrent_render_limit = ${RENDERER_CONCURRENT_LIMIT:-5}

# How long to wait for the browser to render the panel
render_key_lifetime = ${RENDERER_KEY_LIFETIME:-5m}

# How long to wait before timing out the request
request_timeout = ${RENDERER_REQUEST_TIMEOUT:-60}

#################################### Grafana Live ################################
[live]
# Maximum number of simultaneous connections
max_connections = ${LIVE_MAX_CONNECTIONS:-100}

# Allowed origins for WebSocket connections
allowed_origins = ${LIVE_ALLOWED_ORIGINS:-}

# Engine to use for real-time messaging
# Options: "centrifuge" or "grafana-managed"
engine = ${LIVE_ENGINE:-centrifuge}

#################################### SCIM ########################################
[scim]
# Enable SCIM user and group provisioning (Enterprise/Cloud only)
enabled = ${SCIM_ENABLED:-false}

#################################### SQL Expressions ############################
[sql_expressions]
# Enable SQL expressions (Private preview in v12.0)
enabled = ${SQL_EXPRESSIONS_ENABLED:-true}

#################################### Git Sync ####################################
[git_sync]
# Enable Git Sync (Experimental in v12.0)
enabled = ${GIT_SYNC_ENABLED:-false}

# Repository URL
repository_url = ${GIT_SYNC_REPO_URL:-}

# Branch to sync
branch = ${GIT_SYNC_BRANCH:-main}

# Path within repository
path = ${GIT_SYNC_PATH:-dashboards/}

# Sync interval
sync_interval = ${GIT_SYNC_INTERVAL:-5m}

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# "Welcome to the future of observability, choom." - Nexlify Team
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
