[pytest]
# Pytest configuration for Nexlify training pipeline tests

# Test discovery patterns
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Output options - optimized for speed
addopts =
    -v
    --tb=short
    --strict-markers
    --color=yes
    # Performance optimizations
    --durations=10
    --durations-min=1.0
    # Fail fast options (stop on first failure in CI)
    # --maxfail=1 (enable in CI for faster feedback)

# Coverage options (when using pytest-cov)
# Run with: pytest --cov=. --cov-report=html --cov-report=term
# For speed, coverage should be opt-in, not default

# Ignore warnings from dependencies (reduces noise and speeds up tests)
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::ResourceWarning
    ignore::pytest.PytestUnraisableExceptionWarning
    ignore::pytest.PytestDeprecationWarning
    ignore::FutureWarning
    ignore::UserWarning

# Markers for test categories
markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: marks tests as integration tests
    unit: marks tests as unit tests
    requires_network: marks tests that need network connectivity
    requires_gpu: marks tests that need GPU

# Asyncio configuration for async tests
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function  # Explicit scope for async fixtures (required for pytest-xdist)

# Timeout for individual tests (prevents hanging tests)
timeout = 30  # 30 seconds per test (prevent infinite loops/hangs)

# Test collection optimization
norecursedirs = .git .tox dist build *.egg venv nexlify_data nexlify_training data logs cache

# Parallel execution settings (when using pytest-xdist)
# These are applied when using -n flag
# looponfailroots = nexlify tests
